import pandas as pd
import qrcode
from urllib.parse import urlencode
import os

# âœ… Use your actual Render-hosted URL
AUTO_LOGIN_URL = "https://oura-auto-login.onrender.com/auto-login"

# âœ… Load user credentials from an Excel file
excel_file = "Oura_login.xlsx"  # Ensure this file is in the repo
users = pd.read_excel(excel_file)

# âœ… Create a folder for storing QR codes
output_folder = "qr_codes"
os.makedirs(output_folder, exist_ok=True)

# âœ… Generate QR codes for each user
for index, row in users.iterrows():
    email = row['Email']
    password = row['Password']

    # âœ… Encode credentials in the URL
    login_params = urlencode({"email": email, "password": password})
    login_url = f"{AUTO_LOGIN_URL}?{login_params}"

    # âœ… Generate the QR Code
    qr = qrcode.make(login_url)

    # âœ… Save the QR code with email as the filename
    qr_filename = f"{email.replace('@', '_at_').replace('.', '_')}.png"
    qr_path = os.path.join(output_folder, qr_filename)
    qr.save(qr_path)

    print(f"âœ… QR Code generated for {email} â†’ {login_url}")

print("\nðŸŽ¯ All QR codes have been generated! Check the 'qr_codes' folder.")
